<!DOCTYPE html>
<html lang="en">
    <head>
        <title>A New Picture of Segregation</title>
        <meta charset="utf-8"/>
        <meta name="viewport" content="initial-scale=1, width=device-width" />
        <!-- jQuery -->

        <!-- PapaParse -->
        <!-- Fonts -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


        <!-- Semantic -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.9.3/dist/semantic.min.css">
<script src="https://cdn.jsdelivr.net/npm/fomantic-ui@2.9.3/dist/semantic.min.js"></script>

        <!-- Dropdown styles included via Fomantic UI above -->

        <!-- Icon -->
        <link href='https://unpkg.com/css.gg@2.1.1/icons/css/menu.css' rel='stylesheet'>

        <!-- D3 -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"  crossorigin="anonymous"></script>

        <!-- Custom Stylesheet -->
        <link rel="stylesheet" type="text/css" href="main.css">

        <!-- Maplibre -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/maplibre-gl@1.15.2/dist/maplibre-gl.min.css">
        <script src="https://cdn.jsdelivr.net/npm/maplibre-gl@1.15.2/dist/maplibre-gl.min.js"></script>
        
        <!-- Mapbox -->
<!--         <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
        <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script> -->

        <!-- Maplibre Search -->
        <script src="https://unpkg.com/@stadiamaps/maplibre-search-box/dist/maplibre-search-box.umd.js"></script>
        <link
          href="https://unpkg.com/@stadiamaps/maplibre-search-box/dist/style.css"
          rel="stylesheet"
        />
        
        <!-- Config (API keys) -->
        <script src="config.js"></script>
        <!-- Jawg search (loaded synchronously via document.write to ensure availability) -->
        <script>
          document.write('<script src="https://api.jawg.io/libraries/jawg-places@latest/jawg-places.js?access-token=' + CONFIG.JAWG_ACCESS_TOKEN + '"><\/script>');
        </script>
        <!-- Protomaps -->
        <script src="https://unpkg.com/pmtiles@2.10.0/dist/index.js"></script>

        <!-- Papaparse -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js" integrity="sha512-dfX5uYVXzyU8+KHqj8bjo7UkOdg18PaOtpa48djpNbZHwExddghZ+ZmzWT06R5v6NSk3ZUfsH6FNEDepLx9hPQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <!-- Scripts -->
        <!-- <script src="js/mapmain.js"></script>
        <script src="js/main.js"></script>
        -->    

        <!-- Us Download map (deferred to avoid blocking main map) -->
        <script src="js/mapdata.js" defer></script>
        <script src="js/usmap.js" defer></script>

    </head>
    <body>
      <!-- Menu button -->
             
      <!-- Intro          /
        <div class="ui dimmerwrapper ">
          <div class="ui page dimmer active">
            <div class="content ui  very padded  container  introSegment">
              <h1 class="ui header introHeader">A New Picture of Segregation:
              <br>Experienced Diversity Using Cell Phone Location Data</h1>
              <p class="ui  introHeader"> text text text
              </p>  -->





      <!-- <div class="ui primary button">Add</div>
              <div id='undim'class="ui disabled big basic loading inverted button introButton"><b>Enter</b></div>
            </div>
          </div> 
 --> 


         <div id ='title bar' class="ui vertical borderless small pointing secondary menu menutitle">
           <!-- <div class="search"> -->

            <div id="my-container"class="ui search maplibregl-ctrl">
              <div id = "searchBar" class="ui icon input">
                <input id="my-input" class="prompt" type="text" placeholder="Search Places">
                <i class="i search icon"></i>
              </div>
              <!-- <div class="results"></div> -->
              <div id="my-result-container" class="results jawg-places-results"></div>
            </div>

              <!-- <div id="my-container" class="ui fluid search mapboxgl-ctrl maplibregl-ctrl">
                 <div id = "searchBar" class="ui fluid search">
                    <input id="my-input" type="text" placeholder="Search Places">
                    <input type="text"  id="searchTerm" placeholder="What are you looking for?">
                    <button type="submit" class="searchButton">
                    <i class="fa fa-search"></i>
                    </button>
                  </div>
                    <div id="my-result-container" class="ui jawg-places-results"></div>
              </div> -->
              <!-- </div> -->

          
              <!-- <div class="right menu rightmenu">>-->
                  <a class="nav-link" id="aboutText">About</a>
                  <a class="nav-link" id="downloadBtn">Download</a>



              <!--</div>-->

              <div class="ui container">
            <div id="icons">
                <a href="https://www.urbandataresearchlab.org/"><img src="jpg/urbanDRL_logo.svg" alt="urbanDRL_logo">
                </a>
                <a href="https://www.ucsb.edu/" id="ucsbLink"><img src="jpg/UCSB_wordmark.svg" alt="UCSB_logo">
                </a>
             </div> 
          </div> 
              </div>

                  <!-- <div id ='menu-buttons' class="my-button">
                            <a href="#">About</a>
                            <a href="download.html">Download</a>
                            <a href="https://www.urbandataresearchlab.org/">Urban Data Research Lab</a>
          </div> -->
              

          <div id="map"></div>  

          
          <div id ='info'>
            <!--<button class="openbtn" onclick="toggleNav()"><i class="gg-menu"></i></button>  -->
             <!--  <div id="mySidepanel" class="sidepanel">

                <a href="#">About</a>
                <a href="download.html">Download</a>
                <a href="#">Contact</a>
              </div> -->
            <!-- Search Bar -->

             <h2>A New Picture of Segregation</h2>
            <h5>City
            
            </h5>

            <div id = "cityDropdown1" class="ui fluid search selection dropdown">
              <input type="hidden" value="city">
              <i class="dropdown icon"></i>
              <div class="text">Select a city</div>
              <div id='cityDropdown' class="menu"></div>
            </div> 
           
            <!-- Toggle Metrics -->
            <h5 >Metric
              <i class="small grey circle info icon link" data-content="test test" data-variation="mini"></i>
            </h5>

            <div id = "censusDropdown1" class="ui fluid search selection dropdown">
              <input type="hidden" value="total_diversity_exp">
              <i class="dropdown icon"></i>
              <div class="text" >Total Experienced Diversity </div>
              <div id='censusDropdown' class="menu"></div>
            </div> 
            <br>

            <!-- Legend -->
                         
              <div class="item compact disabled legendIcon" data-value="legend">
                <div class='left aligned content censusLegend'>
                  <h5 class="header smallHeader ">
                  Legend
                  </h5>
                  <div class="legendBar"></div>
                </div>
               
               
              </div>
            <div class="ui divider"></div>


  <!--<input type="text" id="cityNameInput" placeholder="Enter City Name" />
<button id="searchButton">Search</button>-->
            
            <!-- histogram -->
            <h5 >Metric Distribution
              <i class="grey small circle info icon link" data-title="Elliot Fu" data-content="test test" data-variation="mini"></i>
            </h5>
            <div id="my_histogram"></div>  


            <h5 >Census Characteristics
             <i class="grey small circle info icon link" data-content="test test" data-variation="mini"></i>

           </h5>

            <div class="census-stats">
              <div class="census-stat-item">
                <div class="census-stat-label">White</div>
                <div class="census-stat-value" id="WHPopValue">...</div>
              </div>
              <div class="census-stat-item">
                <div class="census-stat-label">Black</div>
                <div class="census-stat-value" id="BLPopValue">...</div>
              </div>
              <div class="census-stat-item">
                <div class="census-stat-label">Asian</div>
                <div class="census-stat-value" id="ASPopValue">...</div>
              </div>
              <div class="census-stat-item">
                <div class="census-stat-label">Hispanic</div>
                <div class="census-stat-value" id="HIPopValue">...</div>
              </div>
              <div class="census-stat-item">
                <div class="census-stat-label">Other</div>
                <div class="census-stat-value" id="OTPopValue">...</div>
              </div>
              <div class="census-stat-item">
                <div class="census-stat-label">Higher Education</div>
                <div class="census-stat-value" id="baPercValueDisplay">...</div>
              </div>
              <div class="census-stat-item">
                <div class="census-stat-label">Median Income</div>
                <div class="census-stat-value" id="medianIncValue">...</div>
              </div>
            </div>

            
          </div>  
                     <!--<div id='logoContainer'>
             
                  <a href="https://www.urbandataresearchlab.org/" class="logo-link">
                      <img src="jpg/urbanDRL_logo.svg" alt="urbanDRL_logo" class="logo">
                  </a>
              
                
                  <a href="https://aap.cornell.edu/" class="logo-link">
                      <img src="jpg/AAP.svg" alt="AAP_logo" class="logo">
                  </a>
                
          </div>   -->

<div id="functions" class="hidden">
    <div class="first-row">
        <div id="weekDayEndButton" class="ui fluid tiny icon buttons">
          <button id="weekdayButton" class="ui basic button active">Weekday</button>
          <button id="weekendButton" class="ui basic button">Weekend</button>
        </div>
<!--         <button class="ui tiny toggle button weekday" id="tgl" onclick="toggleWeekend(), updateWeekdayWeekend()">Weekday</button> -->
        <div id="intervalButton" class=" ui fluid tiny icon buttons">
            <button id="morningButton" class="ui basic button">Morning</button>
            <button id="afternoonButton" class="ui basic button active">Afternoon</button>
            <button id="eveningButton" class="ui basic button">Evening</button>
            <button id="lateEveningButton" class="ui basic button">Late evening</button>
            <button id="lateNightButton" class="ui basic button">Late night</button>
        </div>
    </div>
    <div class="second-row">
        <div id="styleButton" class=" ui fluid tiny icon buttons">
          <button id="mapStyle2" class="tiny ui basic button active">Basic</button>
        <button id="mapStyle1" class="ui tiny basic button">Satellite</button>
        
        </div>
<!--          <div id="intervalButton" class=" ui fluid tiny icon buttons">
        <button class="ui tiny button" id="reset">Reset</button>
        </div> -->
        <div class="ui slider" id="slider-1"></div>
        
    </div>
</div>
          </div> 

          
      <div class="ui message floating transition hidden infoSegment" id='infoMessage'>
        <i class="large close red icon"></i>


              </div>
              

        </div>




          <div class="overlay" id="overlay"></div>
          <div class="popupIntro">

               <h2>A New Picture of Segregation</h2>
               <p>
                   Traditional measures of segregation rely on where people live, but daily life extends far beyond the home. This map visualizes the <b>National Experienced Racial-Ethnic Diversity (NERD)</b> dataset, which uses anonymized mobile phone location data to measure the diversity people actually encounter throughout their day — at work, during errands, and in leisure activities.
               </p>
               <p>
                   Explore how experienced diversity varies across U.S. metropolitan areas by race, time of day, and day of week. Select a city and metric to compare experienced diversity with traditional residential measures at the census tract level.
               </p>
               <button id="close">Explore the Map</button>
          </div>

          <!-- Download Modal -->
          <div class="overlay" id="downloadOverlay"></div>
          <div class="downloadModal" id="downloadModal">
               <i class="large close red icon" id="closeDownload"></i>
               <h2>Data Download</h2>

               <h4>About the Dataset</h4>
               <p>
                   The <b>National Experienced Racial-Ethnic Diversity (NERD)</b> dataset provides estimates of experienced diversity for the entire United States at the census tract level. Using anonymized mobile phone location data from over 66 million opted-in devices, the dataset measures the diversity people actually encounter throughout their day — not just where they live.
               </p>
               <p>
                   Diversity in potential social interactions is estimated at 38.2 m × 19.1 m spatial resolution and 15-minute temporal resolution for a representative year, then aggregated to the census tract level for data privacy. The dataset includes experienced diversity broken down by race/ethnicity (White, Black, Asian, Hispanic, Other), time of day (morning, afternoon, evening, late evening, late night), and day of week (weekday vs. weekend), along with census demographic characteristics.
               </p>

               <h4>License</h4>
               <p>
                   This dataset is made available under a custom license. Copyright 2023 Wenfei Xu. Please cite the associated publication when using this data.
               </p>

               <h4>Citation</h4>
               <p class="citation">
                   Xu, W., Wang, Z., Attia, N., Attia, Y., Zhang, Y., & Zong, H. (2024). An experienced racial-ethnic diversity dataset in the United States using human mobility data. <i>Scientific Data</i>, 11, 638. <a href="https://doi.org/10.1038/s41597-024-03490-y" target="_blank">https://doi.org/10.1038/s41597-024-03490-y</a>
               </p>

               <h4>Data Dictionary</h4>
               <table>
                   <tr><td><b>Column</b></td><td><b>Description</b></td></tr>
                   <tr><td>STATEFP10</td><td>2010 Census state FIPS code</td></tr>
                   <tr><td>COUNTYFP10</td><td>2010 Census county FIPS code</td></tr>
                   <tr><td>TRACTCE10</td><td>2010 Census census tract code</td></tr>
                   <tr><td>GEOID10</td><td>Census tract identifier (state FIPS + county FIPS + tract code)</td></tr>
                   <tr><td>STATE</td><td>State Name</td></tr>
                   <tr><td>COUNTY</td><td>County Name</td></tr>
                   <tr><td>CBSA Title</td><td>Core Based Statistical Area name</td></tr>
                   <tr><td>total_pop</td><td>Total Population (2020 Census)</td></tr>
                   <tr><td>white_perc</td><td>% Non-Hispanic White Alone (2020)</td></tr>
                   <tr><td>black_perc</td><td>% Non-Hispanic Black Alone (2020)</td></tr>
                   <tr><td>indigenous_perc</td><td>% Non-Hispanic American Indian and Alaska Native Alone (2020)</td></tr>
                   <tr><td>asian_perc</td><td>% Non-Hispanic Asian Alone (2020)</td></tr>
                   <tr><td>pac_isl_perc</td><td>% Non-Hispanic Native Hawaiian and Pacific Islander Alone (2020)</td></tr>
                   <tr><td>other_perc</td><td>% Non-Hispanic Some Other Race Alone (2020)</td></tr>
                   <tr><td>two_more_perc</td><td>% Non-Hispanic Two or More Races (2020)</td></tr>
                   <tr><td>hispanic_perc</td><td>% Hispanic (2020)</td></tr>
                   <tr><td>ba_higher_perc</td><td>% Bachelor's Degree or Higher (2020)</td></tr>
                   <tr><td>median_inc</td><td>Median household income (2021 inflation-adjusted dollars)</td></tr>
                   <tr><td>white_exp_exposure</td><td>White Experienced Diversity (2022)</td></tr>
                   <tr><td>black_exp_diversity</td><td>Black Experienced Diversity (2022)</td></tr>
                   <tr><td>asian_exp_diversity</td><td>Asian Experienced Diversity (2022)</td></tr>
                   <tr><td>hispanic_exp_diversity</td><td>Hispanic Experienced Diversity (2022)</td></tr>
                   <tr><td>other_exp_diversity</td><td>Other Race Experienced Diversity (2022)</td></tr>
                   <tr><td>total_exp_diversity</td><td>Total Experienced Diversity (2022)</td></tr>
                   <tr><td>residential_diversity</td><td>Residential Diversity (2020 Census)</td></tr>
                   <tr><td>diff</td><td>Difference between Total Experienced and Residential Diversity</td></tr>
               </table>

               <h4>Download by State</h4>
               <p>Click a state to download its GeoJSON file from the <a href="https://osf.io/x94gj/" target="_blank">OSF repository</a>.</p>
               <div style="max-width: 1200px">
                   <div style="padding: 10px 0">
                       <div id="mapDownload"></div>
                   </div>
               </div>
          </div>

    </body>
    <footer>
        <script src="js/mapmain.js"></script>
        <!-- <script src="js/charts.js"></script> -->
        <!-- <script src="js/main.js"></script> -->
    </footer>

    
</html>

